<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="png/favicon.ico">
    <title>PITSTOP |Cadastro/Login </title>
    <link rel="stylesheet" href="Cadastro_login.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
        integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/8c17d13a2b.js" crossorigin="anonymous"></script>
</head>

<body>

    <div class="header">
        <div class="container-vermelho"> </div>
        <div class="container-header">
            <ul class="ul">
                <li class="item"><a href="HOME.html"> HOME </a></li>
                <li class="item"><a href="Equipes.html"> EQUIPES </a></li>
                <li class="item"><a href="Igualdade.html"> IGUALDADE </a></li>
                <li class="item"><a href="EnergiaLimpa.html"> ENERGIA LIMPA </a></li>
                <li class="item"><a href="QuizTime.html"> QUIZTIME </a></li>
                <li class="item"><a href=""> CIRCUITOS </a></li>
                <li class="item"><a href=""> SOBRE MIM </a></li>
                <li class="item"><a href=""> ANALYTICS </a></li>
                <li id="titulo"><a href="HOME.html">PITSTOP</a></li><img id="image" src="png/LOGO2.png" alt="">

            </ul>
            <div class="cadastro-logo">
                <a href="Cadastro_login.html"><img id="image2" src="png/cadastro.png" alt=""></a>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="content conteudo1">
            <div class="primeira-coluna">
                <h2 class="titulo titulo1">Bem-vindo de volta!</h2>
                <p class="descricao descricao-primeiro">Para se manter com a gente</p>
                <p class="descricao descricao-primeiro ">por favor logue com suas informações pessoais.</p>
                <button id="btnEntrar" class="botao botao-a">Login</button>
            </div>
            <div class="segunda-coluna">
                <h2 class="titulo titulo2">Crie uma conta.</h2>
                <div class="rede-social">
                    <ul class="lista-sociais">
                        <a class="link-rede-social" href="https://www.facebook.com/?locale=pt_BR">
                            <li class="item-midia"><i class="fa-brands fa-facebook-f"></i></li>
                        </a>
                        <a class="link-rede-social" href="https://www.google.com/intl/pt-BR/gmail/about/">
                            <li class="item-midia"><i class="fa-brands fa-google-plus-g"></i></li>
                        </a>
                        <a class="link-rede-social" href="https://br.linkedin.com/">
                            <li class="item-midia"><i class="fa-brands fa-linkedin-in"></i></li>
                        </a>
                    </ul>
                </div>
                <p class="descricao descricao-segundo"> ou use seu email para o registro:</p>
                <form class="formulario">

                    <label class="label-input" for="">
                        <i class="fa-solid fa-user icon"></i>
                        <input id="input_nomeCompleto" required type="text" placeholder="Nome Completo">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-envelope"></i>
                        <input id="input_email" required type="email" placeholder="E-mail">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-lock"></i>
                        <input id="input_password" required type="password" placeholder="senha">
                    </label>

                    <button onclick="handleCadastroFormSubmission()" type="button" class="botao botao-b">
                        <p class="texto">cadastrar</p>
                    </button>
                </form>
            </div>
        </div>

        <div class="content conteudo2">
            <div class="primeira-coluna">
                <h2 class="titulo titulo1">Olá amigo!</h2>
                <p class="descricao descricao-primeiro">Insira seus dados pessoais</p>
                <p class="descricao descricao-primeiro">e comece essa jornada conosco</p>
                <button id="cadastrar" class="botao botao-a">
                    <p class="texto">Cadastrar</p>
                </button>
            </div>
            <div class="segunda-coluna">
                <h2 class="titulo titulo2"> Logue no PITSTOP.</h2>
                <div class="rede-social">
                    <ul class="lista-sociais">
                        <a class="link-rede-social" href="https://www.facebook.com/?locale=pt_BR">
                            <li class="item-midia"><i class="fa-brands fa-facebook-f"></i></li>
                        </a>
                        <a class="link-rede-social" href="https://www.google.com/intl/pt-BR/gmail/about/">
                            <li class="item-midia"><i class="fa-brands fa-google-plus-g"></i></li>
                        </a>
                        <a class="link-rede-social" href="https://br.linkedin.com/">
                            <li class="item-midia"><i class="fa-brands fa-linkedin-in"></i></li>
                        </a>
                    </ul>
                </div>
                <p class="descricao descricao-segundo"> ou use seu email para o registro:</p>
                <form class="formulario">
                    <label class="label-input" for="">
                        <i class="fa-solid fa-user icon-modify"></i>
                        <input input="input_nomeLogin" type="text" placeholder="Nome Completo">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-envelope icon-modify"></i>
                        <input input="input_emailLogin" type="email" placeholder="E-mail">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-lock icon-modify"></i>
                        <input input="input_passwordLogin" type="password" placeholder="senha">
                    </label>
                    <a class="senha" href="#">esqueceu sua senha?</a>
                    <button onclick="handleLoginFormSubmision()" type="button" class="botao botao-b">Entrar</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        var btnEntrar = document.querySelector("#btnEntrar");
        var btnCadastrar = document.querySelector("#cadastrar");
        var body = document.querySelector("body")

        btnEntrar.addEventListener("click", function () {
            body.className = "entrar-js";
        })

        btnCadastrar.addEventListener("click", async function () {
            body.className = "cadastrar-js";
        })


        function cadastrar() {
            // aguardar();

            //Recupere o valor da nova input pelo nome do id
            // Agora vá para o método fetch logo abaixo
            var nomeLogin = input_nomeLogin.value;
            var emailLoginVar = input_emailLogin.value;
            var senhaLoginVar = input_passwordLogin.value;

            if (
                nomeVar == "" ||
                emailVar == "" ||
                senhaVar == "" ||
                confirmacaoSenhaVar == ""
            ) {
                cardErro.style.display = "block";
                alert('Mensagem de erro para todos os campos em branco');

                // finalizarAguardar();
                return false;
            } else {
                setInterval(sumirMensagem, 5000);
            }
            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeServer: nomeLoginVar,
                    emailServer: emailLoginVar,
                    senhaServer: senhaLoginVar,
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                        // cardErro.style.display = "block";

                        // mensagem_erro.innerHTML =
                        //   "Cadastro realizado com sucesso! Redirecionando para tela de Login...";
                        // window.location = "index.html";
                        setTimeout(function () {
                            window.location = "login.html";
                        }, 1000); // apenas para exibir o loading
                        limparFormulario();
                        // finalizarAguardar();
                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }

                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                    // finalizarAguardar();
                });

            return false;
        }


        function sumirMensagem() {
            cardErro.style.display = "none";
        }



        function entrar() {
            aguardar();

            var nomeLogin = input_nomeLogin.value;
            var emailLogin = input_emailLogin.value;
            var senhaLogin = input_passwordLogin.value;

            if (emailLoginVar == "" || senhaLoginVar == "") {
                cardErro.style.display = "block"
                mensagem_erro.innerHTML = "(Mensagem de erro para todos os campos em branco)";
                finalizarAguardar();
                return false;
            }
            else {
                setInterval(sumirMensagem, 5000)
            }

            console.log("FORM LOGIN: ", emailLogin);
            console.log("FORM SENHA: ", senhaLogin);

            fetch("/usuarios/autenticar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    emailServer: emailLogin,
                    senhaServer: senhaLogin,
                    nomeServer: nomeLogin
                })
            }).then(function (resposta) {
                console.log("ESTOU NO THEN DO entrar()!")

                if (resposta.ok) {
                    console.log(resposta);

                    resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));
                        sessionStorage.EMAIL_USUARIO = json.email;
                        sessionStorage.NOME_USUARIO = json.nomeCompleto;
                        sessionStorage.ID_USUARIO = json.idUsuario;


                        setTimeout(function () {
                            window.location = "dashboard.html";
                        }, 1000); // apenas para exibir o loading

                    });

                } else {

                    console.log("Houve um erro ao tentar realizar o login!");

                    resposta.text().then(texto => {
                        console.error(texto);
                        finalizarAguardar(texto);
                    });
                }

            }).catch(function (erro) {
                console.log(erro);
            })

            return false;
        }

        function sumirMensagem() {
            cardErro.style.display = "none"
        }

        // async function handleCadastroFormSubmission() {
        //     var nomeCompleto = document.getElementById("input_nomeCompleto").value;
        //     var email = document.getElementById("input_email").value;
        //     var senha = document.getElementById("input_password").value;

        //     var cadastradoComSucesso = await cadastrarNovoUsuario(nomeCompleto, email, senha);

        //     // if ternário -> Ler: https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/Conditional_operator
        //     // body.className = cadastro ? "entrar-js" : "cadastrar-js";

        //     if (cadastradoComSucesso) {
        //         body.className = "entrar-js";
        //     } else {
        //         body.className = "cadastrar-js";
        //     }
        // }

        // async function cadastrarNovoUsuario(nomeCompleto, email, senha) {
        //     var requestBody = {
        //         nome: nomeCompleto,
        //         email: email,
        //         senha: senha
        //     };

        //     var respostaCadastroUsuario = await enviarRequisicaoCadastro('/usuarios/cadastrar', requestBody);

        //     return respostaCadastroUsuario.ok;
        // }

        // async function enviarRequisicaoCadastro(url, requestBody) {

        //     // fetch inicia o processo de busca de um recurso da rede e retorna uma promessa -> https://developer.mozilla.org/pt-BR/docs/Web/API/fetch
        //     // o await serve para esperar que uma promessa seja resolvida antes de continuar a execução do código, só é possível usar await em funções assincronas -> https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Statements/async_function

        //     var respostaCadastroUsuario = await fetch(url, {
        //         body: JSON.stringify(requestBody),
        //         method: 'POST',
        //         headers: {
        //             "Content-Type": "application/json",
        //         }
        //     });

        //     return respostaCadastroUsuario;
        // }

        // async function handleLoginFormSubmision(){
        //     var nomeCompleto = document.getElementById("input_nomeLogin").value;
        //     var email = document.getElementById("input_emailLogin").value;
        //     var senha = document.getElementById("input_passwordLogin").value;

        //     var logadoComSucesso = await fazerLogin(nomeCompleto, email, senha);

        //     if(logadoComSucesso){
        //         window.location = "dashboard.html"
        //     }else{
        //         body.className = "entrar-js";
        //     }
        //   }

        //   async function fazerLogin(nomeCompleto, emai, senha){

        //     var respostaLogarUsuario = await enviarLoginUsuario('/usuarios/entrar', requestBody)

        //     return respostaLogarUsuario.ok;

        // async function enviarRequisicaoCadastro(url, requestBody) {

    </script>
</body>

</html>