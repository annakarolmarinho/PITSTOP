<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="png/favicon.ico">
    <title>PITSTOP |Cadastro/Login </title>
    <link rel="stylesheet" href="Cadastro_login.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
        integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/8c17d13a2b.js" crossorigin="anonymous"></script>
</head>

<body>

    <div class="header">
        <div class="container-vermelho"> </div>
        <div class="container-header">
            <ul class="ul">
                <li class="item"><a href="../index.html"> HOME </a></li>
                <li class="item"><a href="../Equipes/Equipes.html"> EQUIPES </a></li>
                <li class="item"><a href="../Igualdade/Igualdade.html"> IGUALDADE </a></li>
                <li class="item"><a href="../energia limpa/EnergiaLimpa.html"> ENERGIA LIMPA </a></li>
                <li class="item"><a href="../QuizTime/"> QUIZTIME </a></li>
                <li class="item"><a href="../circuitos/circuitosMonaco.html"> CIRCUITOS </a></li>
                <li class="item"><a href="../SobreMim/sobreMim.html"> SOBRE MIM </a></li>
                <li class="item"><a href=""> ANALYTICS </a></li>
                <li id="titulo"><a href="../Home/HOME.html">PITSTOP</a></li><img id="image" src="png/LOGO2.png" alt="">

            </ul>
            <div class="cadastro-logo">
                <a href="Cadastro_login.html"><img id="image2" src="png/cadastro.png" alt=""></a>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="content conteudo1">
            <div class="primeira-coluna">
                <h2 class="titulo titulo1">Bem-vindo de volta!</h2>
                <p class="descricao descricao-primeiro">Para se manter com a gente</p>
                <p class="descricao descricao-primeiro ">por favor logue com suas informações pessoais.</p>
                <button id="btnEntrar" class="botao botao-a">Login</button>
            </div>
            <div class="segunda-coluna">
                <h2 class="titulo titulo2">Crie uma conta.</h2>
                <div class="rede-social">
                    <ul class="lista-sociais">
                        <a class="link-rede-social" href="https://www.facebook.com/?locale=pt_BR">
                            <li class="item-midia"><i class="fa-brands fa-facebook-f"></i></li>
                        </a>
                        <a class="link-rede-social" href="https://www.google.com/intl/pt-BR/gmail/about/">
                            <li class="item-midia"><i class="fa-brands fa-google-plus-g"></i></li>
                        </a>
                        <a class="link-rede-social" href="https://br.linkedin.com/">
                            <li class="item-midia"><i class="fa-brands fa-linkedin-in"></i></li>
                        </a>
                    </ul>
                </div>
                <p class="descricao descricao-segundo"> ou use seu email para o registro:</p>
                <form class="formulario">

                    <label class="label-input" for="">
                        <i class="fa-solid fa-user icon"></i>
                        <input id="input_nomeCompleto" required type="text" placeholder="Nome Completo">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-envelope"></i>
                        <input id="input_email" required type="email" placeholder="E-mail">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-lock"></i>
                        <input id="input_password" required type="password" placeholder="senha">
                    </label>

                    <button onclick="cadastrar()" type="button" class="botao botao-b">
                        <p class="texto">cadastrar</p>
                    </button>
                </form>
            </div>
        </div>

        <div class="content conteudo2">
            <div class="primeira-coluna">
                <h2 class="titulo titulo1">Olá amigo!</h2>
                <p class="descricao descricao-primeiro">Insira seus dados pessoais</p>
                <p class="descricao descricao-primeiro">e comece essa jornada conosco</p>
                <button id="cadastrar" class="botao botao-a">
                    <p class="texto">Cadastrar</p>
                </button>
            </div>
            <div class="segunda-coluna">
                <h2 class="titulo titulo2"> Logue no PITSTOP.</h2>
                <div class="rede-social">
                    <ul class="lista-sociais">
                        <a class="link-rede-social" href="https://www.facebook.com/?locale=pt_BR">
                            <li class="item-midia"><i class="fa-brands fa-facebook-f"></i></li>
                        </a>
                        <a class="link-rede-social" href="https://www.google.com/intl/pt-BR/gmail/about/">
                            <li class="item-midia"><i class="fa-brands fa-google-plus-g"></i></li>
                        </a>
                        <a class="link-rede-social" href="https://br.linkedin.com/">
                            <li class="item-midia"><i class="fa-brands fa-linkedin-in"></i></li>
                        </a>
                    </ul>
                </div>
                <p class="descricao descricao-segundo"> ou use seu email para o registro:</p>
                <form class="formulario">
                    <label class="label-input" for="">
                        <i class="fa-solid fa-user icon-modify"></i>
                        <input id="input_nomeLogin" type="text" placeholder="Nome Completo">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-envelope icon-modify"></i>
                        <input id="input_emailLogin" type="email" placeholder="E-mail">
                    </label>
                    <label class="label-input" for="">
                        <i class="fa-solid fa-lock icon-modify"></i>
                        <input id="input_passwordLogin" type="password" placeholder="senha">
                    </label>
                    <a class="senha" href="#">esqueceu sua senha?</a>
                    <button onclick="entrar()" type="button" class="botao botao-b">Entrar</button>
                </form>
            </div>
        </div>
    </div>
    <div id="errorToast" class="toast">
        Ocorreu um erro!
    </div>
    <script>
        var btnEntrar = document.querySelector("#btnEntrar");
        var btnCadastrar = document.querySelector("#cadastrar");
        var body = document.querySelector("body")

        btnEntrar.addEventListener("click", function () {
            body.className = "entrar-js";
        })

        btnCadastrar.addEventListener("click", async function () {
            body.className = "cadastrar-js";
        })


        function cadastrar() {
            // aguardar();

            //Recupere o valor da nova input pelo nome do id
            // Agora vá para o método fetch logo abaixo
            var nomeVar = input_nomeCompleto.value;
            var emailVar = input_email.value;
            var senhaVar = input_password.value;

            if (nomeVar == "" || emailVar == "" || senhaVar == "") {
                cardErro.style.display = "block";
                alert('Mensagem de erro para todos os campos em branco');

                // finalizarAguardar();
                return false;
            } else {
                setInterval(sumirMensagem, 5000);
            }
            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeServer: nomeVar,
                    emailServer: emailVar,
                    senhaServer: senhaVar,
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                        // cardErro.style.display = "block";

                        // mensagem_erro.innerHTML =
                        //   "Cadastro realizado com sucesso! Redirecionando para tela de Login...";
                        // window.location = "index.html";
                        setTimeout(function () {
                            body.className = "entrar-js";
                        }, 1000); // apenas para exibir o loading
                        limparFormulario();
                        // finalizarAguardar();
                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";

                    }

                })
                .catch(function (resposta) {
                    showErrorToast(resposta);
                });

            return false;
        }



        function entrar() {
            // aguardar();

            var nomeLogin = input_nomeLogin.value;
            var emailLogin = input_emailLogin.value;
            var senhaLogin = input_passwordLogin.value;

            var listaErros = validarFormulario(nomeLogin, emailLogin, senhaLogin);

            if (listaErros.length > 0) {
                let mensagem = "";
                for (var erro of listaErros) {
                    mensagem += erro + '\n';
                }
                showErrorToast(mensagem);
                return;
            }

            console.log("FORM LOGIN: ", emailLogin);
            console.log("FORM SENHA: ", senhaLogin);

            fetch("/usuarios/autenticar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    emailServer: emailLogin,
                    senhaServer: senhaLogin,
                    nomeServer: nomeLogin
                })
            }).then(function (resposta) {
                console.log("ESTOU NO THEN DO entrar()!")

                if (resposta.ok) {
                    console.log(resposta);

                    resposta.json().then(json => {
                        console.log("Chegou aqui");
                        console.log(json);
                        console.log(JSON.stringify(json));
                        sessionStorage.EMAIL_USUARIO = json.email;
                        sessionStorage.NOME_USUARIO = json.nomeCompleto;
                        sessionStorage.ID_USUARIO = json.idUsuario;


                        setTimeout(function () {
                            window.location = "dashboard.html";
                        }, 1000); // apenas para exibir o loading

                    });

                } else {

                    console.log("Houve um erro ao tentar realizar o login!");

                    if (resposta.status == 403) {
                        showErrorToast('Usuário ou senha inválidos');
                    }

                    resposta.text().then(texto => {
                        console.error(texto);
                        finalizarAguardar(texto);
                    });
                }

            }).catch(function (erro) {
                console.log(erro);
            });
        }


        function showErrorToast(message) {
            var toast = document.getElementById("errorToast");
            toast.classList.add("show-toast");

            toast.innerHTML = message;

            setTimeout(function () {
                toast.classList.remove("show-toast");
            }, 3000);
        }

        function validarFormulario(nome, email, senha) {

            var listaErros = [];

            if (!validarEmail(email)) {
                listaErros.push('Por favor, insira um email válido.');
            }

            if (nome.trim() === '') {
                listaErros.push('Por favor, insira um nome.');
            }

            if (senha.length < 6) {
                listaErros.push('A senha deve ter pelo menos 6 caracteres.');
            }

            return listaErros;
        }

        function validarEmail(email) {
            var indiceArroba = email.indexOf('@');
            var indicePonto = email.lastIndexOf('.');

            if (indiceArroba < 0 || indicePonto < 0 || indiceArroba > indicePonto || indiceArroba === 0 || indicePonto === email.length - 1) {
                return false;
            }

            return true;
        }
    </script>
</body>

</html>